# Adds namespace to all resources.
namespace: openshift-builds

# The Value of this field is prepended to the
# names of all resources.
namePrefix: openshift-builds-

# Labels to add to all resources and selectors.
#labels:
#- includeSelectors: true
#  pairs:
#    someName: someValue

labels:
  - pairs:
      app.kubernetes.io/part-of: openshift-builds
      app.kubernetes.io/version: 1.5.0

resources:
- ../crd
- ../rbac
- ../manager
# [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix including the one in
# crd/kustomization.yaml
#- ../webhook
# [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER'. 'WEBHOOK' components are required.
#- ../certmanager
# [PROMETHEUS] To enable prometheus monitor, uncomment all sections with 'PROMETHEUS'.
#- ../prometheus

patches:
# Protect the /metrics endpoint by putting it behind auth.
# If you want your controller-manager to expose the /metrics
# endpoint w/o any authn/z, please comment on the following line.
- path: manager_auth_proxy_patch.yaml

# [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix including the one in
# crd/kustomization.yaml
#- path: manager_webhook_patch.yaml

# [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER'.
# Uncomment 'CERTMANAGER' sections in crd/kustomization.yaml to enable the CA injection in the admission webhooks.
# 'CERTMANAGER' needs to be enabled to use ca injection
#- path: webhookcainjection_patch.yaml

# Ensure ClusterRoleBinding references are updated after namePrefix.
# This avoids producing a ClusterRoleBinding whose roleRef still points to the un-prefixed name.
replacements:
- source:
    kind: ClusterRole
    name: operator
    fieldPath: metadata.name
  targets:
  - select:
      kind: ClusterRoleBinding
      name: operator-binding
    fieldPaths:
    - roleRef.name
- source:
    kind: ServiceAccount
    name: operator
    fieldPath: metadata.name
  targets:
  - select:
      kind: ClusterRoleBinding
      name: operator-binding
    fieldPaths:
    - subjects.0.name
- source:
    kind: ServiceAccount
    name: operator
    fieldPath: metadata.namespace
  targets:
  - select:
      kind: ClusterRoleBinding
      name: operator-binding
    fieldPaths:
    - subjects.0.namespace
